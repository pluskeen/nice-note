作用域即变量的合法使用范围，作用域分以下几种：

-   全局作用域：脚本模式运行所有代码的默认作用域
-   模块作用域：模块模式中运行代码的作用域
-   函数作用域：由函数创建的作用域

此外，用 `let` 或 `const` 声明的变量属于额外的作用域：

-   块级作用域：用一对花括号创建出来的作用域


##### 全局作用域

浏览器中，全局作用域一般指 `window`。
`Node` 中，全局作用域一般指 `global`。


##### 模块作用域

一个模块（module）即一个脚本或一个文件。模块之间可以相互加载，需要使用 `export` 和 `import` 命令来交换功能：

-   `export` 标记了可以外部模块可以访问的变量和函数。
-   `import` 允许从其他模块导入功能。

模块之间的作用域相互独立，即每个模块都有自己独立的模块作用域。

使用模块需要注意：

-   代码是在模块作用域之中运行，而不是在全局作用域运行。模块内部的顶层变量，外部不可见。
-   模块脚本自动采用严格模式，不管有没有声明 `use strict`。
-   模块之中，可以使用 `import` 命令加载其他模块（`.js` 后缀不可省略，需要提供绝对 URL 或相对 URL），也可以使用 `export` 命令输出对外接口。
-   模块之中，顶层的 `this` 关键字返回 `undefined`，而不是指向 `window`。也就是说，在模块顶层使用 `this` 关键字，是无意义的。
-   同一个模块如果加载多次，将只执行一次。


##### 块级作用域

块级作用域只对 `let` 和 `const` 声明有效，对 `var` 声明无效。

``` js
{
  var x = 1;
}
console.log(x); // 1

{
  const x = 1;
}
console.log(x); // ReferenceError: x is not defined
```

块级作用域允许的任意嵌套。

```js
{{{{
  {let insane = 'Hello World'}
  console.log(insane); // 报错
}}}};
```

上面代码使用了一个五层的块级作用域，每一层都是一个单独的作用域。第四层作用域无法读取第五层作用域的内部变量。

```js
{{{{
  let insane = 'Hello World';
  {let insane = 'Hello World'} // 内层作用域可以定义外层作用域的同名变量
}}}};
```


##### 函数作用域

![[函数作用域.png]]

上图中，每个红框代表一个作用域，最外层是全局作用域，其他的都是函数作用域。`fn3` 函数中存在 `a`，`a1`，`a2` 三个[[自由变量与闭包#自由变量|自由变量]]，其值会一层一层向上级作用域查找。